package com.mmt.diagnosis.service.probability;

import com.mmt.diagnosis.domain.Probability;
import com.mmt.diagnosis.domain.StudentTests;
import com.mmt.diagnosis.dto.details.DetailsResponse;
import com.mmt.diagnosis.repository.AnswerRepository;
import com.mmt.diagnosis.repository.ProbabilityRepository;
import com.mmt.diagnosis.service.studentTest.StudentTestService;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;

@Service
public class ProbabilityService {

    private final ProbabilityRepository probabilityRepository;
    private final AnswerRepository answerRepository;
    private final StudentTestService studentTestService;


    public ProbabilityService(ProbabilityRepository probabilityRepository, AnswerRepository answerRepository, StudentTestService studentTestService) {
        this.probabilityRepository = probabilityRepository;
        this.answerRepository = answerRepository;
        this.studentTestService = studentTestService;
    }

    // 리팩토링 : 1->N 관계를 반복할 때 유용한 자료구조 찾아보기
    public void create(Long studentTestId, double[] probabilityList){
        // test용
        probabilityList = new double[]{0.21878546, 0.18749207, 0.21141115, 0.14204189, 0.3060516, 0.43843335, 0.13824528, 0.24293572, 0.29306823, 0.46317494, 0.22867852, 0.27158165, 0.31583995, 0.26097667, 0.20880854, 0.2380619, 0.1781711, 0.15863243, 0.33076137, 0.18987328, 0.24275202, 0.35819367, 0.13141888, 0.21555358, 0.20168579, 0.17358416, 0.2317765, 0.46435127, 0.23516217, 0.21147582, 0.1722328, 0.21395776, 0.16793036, 0.2520765, 0.21301204, 0.11219534, 0.11622006, 0.13046926, 0.5056347, 0.29896092, 0.10936737, 0.18829903, 0.13346136, 0.27193427, 0.14742231, 0.22046271, 0.27016452, 0.24477816, 0.29712272, 0.3216843, 0.17537344, 0.22760957, 0.18388227, 0.13776043, 0.07637867, 0.3385259, 0.31684834, 0.11513978, 0.11762634, 0.13327384, 0.09183255, 0.21134391, 0.11884716, 0.37234446, 0.6469099, 0.19891924, 0.23358917, 0.11878529, 0.14472213, 0.29564834, 0.11788067, 0.07992777, 0.39335102, 0.13723764, 0.2239722, 0.15237302, 0.16703928, 0.1239163, 0.10363862, 0.5271157, 0.09627199, 0.16640902, 0.08081457, 0.14252278, 0.19819322, 0.6050977, 0.10116881, 0.18496907, 0.1082716, 0.09383759, 0.18677166, 0.35737184, 0.20691454, 0.055998415, 0.19677794, 0.2386575, 0.19618389, 0.25335324, 0.29660693, 0.48791006, 0.49766746, 0.24146679, 0.2680109, 0.49828985, 0.26825365, 0.21001169, 0.18842801, 0.29618603, 0.14610386, 0.24273238, 0.2497766, 0.16159937, 0.2805257, 0.42817512, 0.2036978, 0.101673365, 0.43265834, 0.17690545, 0.23768654, 0.13837412, 0.21260014, 0.2570628, 0.1594165, 0.16902566, 0.24972385, 0.41450983, 0.27138835, 0.29384583, 0.2101464, 0.1327292, 0.23475209, 0.2998371, 0.22762892, 0.20426086, 0.27784473, 0.25426948, 0.26301283, 0.4576699, 0.3320269, 0.1407829, 0.33216262, 0.61283374, 0.30345175, 0.23805007, 0.123003155, 0.5801815, 0.28464386, 0.45399705, 0.3860971, 0.5068371, 0.5070166, 0.5560576, 0.45517996, 0.65066516, 0.5161051, 0.52829087, 0.6571165, 0.44506162, 0.51649004, 0.45177388, 0.5181578, 0.5147666, 0.46026865, 0.75810194, 0.6146705, 0.5796552, 0.53628963, 0.62625414, 0.518788, 0.3993984, 0.6683043, 0.4241659, 0.105572104, 0.17094758, 0.22207296, 0.28520787, 0.30313239, 0.4349727, 0.23828557, 0.21050975, 0.37888882, 0.17165217, 0.19743177, 0.20531234, 0.22760153, 0.11659211, 0.19248262, 0.20414773, 0.13457128, 0.15549174, 0.2633937, 0.25030643, 0.12504882, 0.095979065, 0.21252328, 0.11144021, 0.17710653, 0.14491752, 0.18451661, 0.11721164, 0.14030749, 0.116601795, 0.09378445, 0.18965745, 0.092511445, 0.45038432, 0.18005839, 0.10432348, 0.16096815, 0.49806023, 0.20434606, 0.12947604, 0.47348648, 0.30697167, 0.21003938, 0.18525255, 0.17452666, 0.174741, 0.10980302, 0.0973396, 0.18307695, 0.300685, 0.18008557, 0.0945608, 0.12719503, 0.25473058, 0.099273056, 0.11944711, 0.2093916, 0.11721456, 0.18667218, 0.23968482, 0.20938742, 0.14179057, 0.08777535, 0.25559947, 0.19354162, 0.19349077, 0.20823252, 0.12761593, 0.53950816, 0.11411208, 0.18616155, 0.18975607, 0.2179128, 0.23553139, 0.18313402, 0.30804294, 0.34946176, 0.16478395, 0.11268613, 0.20564204, 0.101017445, 0.21013534, 0.2079632, 0.107829124, 0.15223122, 0.10767993, 0.3030883, 0.14840522, 0.079610854, 0.1261965, 0.1041213, 0.14774954, 0.21697018, 0.21432075, 0.54613614, 0.13224682, 0.16427961, 0.18363515, 0.13515005, 0.17027646, 0.19877934, 0.08830181, 0.12310633, 0.33558124, 0.3224002, 0.14672771, 0.11505541, 0.3760711, 0.27439314, 0.3052402, 0.22289029, 0.15919346, 0.12048042, 0.08929351, 0.10545257, 0.17452294, 0.11567426, 0.08336267, 0.07573667, 0.09656638, 0.13553232, 0.19201055, 0.11847621, 0.12408671, 0.33035094, 0.18932098, 0.13655812, 0.17501536, 0.75584674, 0.16535807, 0.17845994, 0.12691486, 0.2904058, 0.14593804, 0.19712302, 0.17318296, 0.13616869, 0.121776044, 0.1858958, 0.33670056, 0.16272342, 0.13304096, 0.19638014, 0.20905244, 0.047911912, 0.29435852, 0.15125164, 0.080073446, 0.25262514, 0.21230105, 0.1967439, 0.15037343, 0.16576481, 0.10367581, 0.10645831, 0.10598621, 0.1564464, 0.110682845, 0.14617682, 0.1365292, 0.11639929, 0.16600427, 0.085313976, 0.23680806, 0.56128156, 0.44562984, 0.5314641, 0.48576963, 0.5605644, 0.47572008, 0.55819297, 0.44299084, 0.5325665, 0.46388862, 0.44932806, 0.54292226, 0.48452532, 0.52678126, 0.50424325, 0.48627833, 0.53015065, 0.48648277, 0.5290754, 0.49849004, 0.5465418, 0.514696, 0.40386763, 0.54365134, 0.497898, 0.5281806, 0.59285736, 0.51424, 0.44321147, 0.4644907, 0.53546625, 0.53226876, 0.54560673, 0.517528, 0.4740069, 0.4365177, 0.40462312, 0.4463626, 0.45463285, 0.4926031, 0.49556106, 0.5012697, 0.49887887, 0.5209195, 0.47014862, 0.5150173, 0.45083946, 0.5206106, 0.5741017, 0.50854933, 0.5306021, 0.42945516, 0.50805146, 0.5593283, 0.4840624, 0.5231317, 0.48820004, 0.51826584, 0.41178346, 0.46684316, 0.46449977, 0.49290025, 0.47241104, 0.44980752, 0.49251923, 0.54590976, 0.5571939, 0.49336454, 0.20659333, 0.1755982, 0.26908743, 0.43699965, 0.4917167, 0.18593046, 0.18152353, 0.1862812, 0.14391118, 0.3294214, 0.33780938, 0.17910847, 0.19754213, 0.6970994, 0.45816445, 0.7238414, 0.5547751, 0.65746874, 0.5872454, 0.53615516, 0.6929042, 0.60577285, 0.59819174, 0.44474527, 0.53889364, 0.78263426, 0.4433925, 0.6564336, 0.4757259, 0.42298818, 0.7498484, 0.44607756, 0.49271876, 0.5926592, 0.43715683, 0.4628471, 0.39437816, 0.6096313, 0.5906635, 0.7200513, 0.47754338, 0.4897252, 0.4286173, 0.56433845, 0.49086487, 0.5683561, 0.51109236, 0.5079712, 0.5120479, 0.563551, 0.44788882, 0.52131206, 0.44523522, 0.5516205, 0.45737815, 0.4914144, 0.5252649, 0.57110065, 0.4359039, 0.4997104, 0.55019534, 0.5391584, 0.5037444, 0.48965818, 0.42183346, 0.42851186, 0.57373273, 0.48921296, 0.50493103, 0.50885564, 0.53499144, 0.39849588, 0.42451164, 0.46907315, 0.50971955, 0.4735085, 0.384919, 0.2735963, 0.17397723, 0.4482466, 0.4923755, 0.42965606, 0.35153687, 0.3613999, 0.4306851, 0.45056367, 0.49318194, 0.28001127, 0.4437921, 0.5065019, 0.5753759, 0.17043951, 0.4228611, 0.40229568, 0.37401885, 0.20511767, 0.31711155, 0.38954762, 0.42469037, 0.31205893, 0.37956876, 0.42817092, 0.14959505, 0.15866822, 0.44116104, 0.47572625, 0.5114282, 0.33921963, 0.2885274, 0.46521282, 0.3200927, 0.5697669, 0.49680915, 0.1855537, 0.28058666, 0.27297938, 0.61808604, 0.59082496, 0.34964037, 0.1805355, 0.46894622, 0.23237997, 0.47254902, 0.27771008, 0.5052941, 0.29833424, 0.55320746, 0.25479305, 0.28856233, 0.201419, 0.39457935, 0.47024092, 0.49163646, 0.514379, 0.5900658, 0.5152051, 0.2665732, 0.2217797, 0.31170225, 0.23139307, 0.3202172, 0.29326218, 0.49935997, 0.46196088, 0.5134721, 0.8759269, 0.51528156, 0.5043278, 0.39750406, 0.48850533, 0.7434838, 0.5425568, 0.41973928, 0.70682126, 0.5526477, 0.64685726, 0.56192845, 0.86197555, 0.48301047, 0.50399435, 0.58273274, 0.61929935, 0.52232844, 0.40124255, 0.58713794, 0.73545986, 0.6608168, 0.5406331, 0.4406048, 0.47400853, 0.42877632, 0.5571428, 0.5250064, 0.55625033, 0.48210987, 0.55043995, 0.4589464, 0.40893528, 0.5916144, 0.49858162, 0.4495621, 0.4844242, 0.5145331, 0.5455302, 0.53163433, 0.47906816, 0.5647627, 0.45265692, 0.5194391, 0.5991916, 0.5334504, 0.47013932, 0.49792743, 0.5246365, 0.54163754, 0.46435785, 0.44927216, 0.4933104, 0.49393192, 0.49284187, 0.59795374, 0.45055705, 0.57848006, 0.53549135, 0.45456997, 0.509476, 0.46418113, 0.46377236, 0.51524913, 0.49306372, 0.50782925, 0.4552007, 0.6046083, 0.5723576, 0.4414005, 0.49781775, 0.42896628, 0.5348169, 0.55812025, 0.59317636, 0.5133911, 0.49812707, 0.5760107, 0.5546899, 0.43583325, 0.5186156, 0.44832364, 0.52807826, 0.46568918, 0.45855916, 0.55655664, 0.4588058, 0.51391876, 0.47694492, 0.43386182, 0.46486956, 0.48594204, 0.52630705, 0.42451203, 0.081261605, 0.23228768, 0.32624072, 0.19491577, 0.21264622, 0.1470933, 0.22694546, 0.28577542, 0.09297678, 0.18849391, 0.19629034, 0.24147132, 0.085452944, 0.18118158, 0.13930938, 0.23643634, 0.55900174, 0.10638276, 0.14831975, 0.34483328, 0.1762217, 0.33736116, 0.2790184, 0.3153187, 0.077231616, 0.15228584, 0.19202855, 0.1523757, 0.19143593, 0.09511015, 0.2590736, 0.12661853, 0.12050152, 0.06453964, 0.21880189, 0.51039934, 0.19712019, 0.10144168, 0.41242486, 0.42488238, 0.24970719, 0.4035064, 0.17371687, 0.22656521, 0.27389225, 0.5047028, 0.34012982, 0.3171965, 0.36092243, 0.27473253, 0.56383705, 0.13937008, 0.30198598, 0.54550314, 0.22061688, 0.31682795, 0.49718803, 0.2582421, 0.31235862, 0.23477045, 0.2616924, 0.19557819, 0.19300565, 0.18449104, 0.53026026, 0.19755346, 0.12329212, 0.2643484, 0.3025665, 0.20884451, 0.53074545, 0.285687, 0.27176887, 0.27275282, 0.211108, 0.21910423, 0.28192934, 0.62935936, 0.30899683, 0.3385594, 0.2703383, 0.1581847, 0.38754398, 0.20369312, 0.28663313, 0.27285618, 0.19850105, 0.30011854, 0.7739731, 0.63413435, 0.66078824, 0.53030604, 0.6599024, 0.54346466, 0.66502136, 0.6794704, 0.5148528, 0.7442856, 0.5655877, 0.4957798, 0.64572257, 0.5120078, 0.5114866, 0.5673256, 0.47968316, 0.5527223, 0.5677096, 0.62019825, 0.580074, 0.4796688, 0.507436, 0.70994914, 0.49321866, 0.42019346, 0.5917368, 0.54767215, 0.52407885, 0.47293943, 0.43687466, 0.45567825, 0.49359435, 0.5266551, 0.5529664, 0.4945626, 0.5065463, 0.51132935, 0.46028095, 0.48842475, 0.4739825, 0.46690637, 0.4061926, 0.5128469, 0.58385485, 0.4980792, 0.5700136, 0.4341034, 0.39761898, 0.5239986, 0.55355716, 0.46654403, 0.5388485, 0.50129014, 0.57302576, 0.45250025, 0.45600754, 0.5257001, 0.5032952, 0.4634347, 0.4962626, 0.58202964, 0.59978914, 0.5262649, 0.53492975, 0.570581, 0.50172496, 0.49446282, 0.55340093, 0.447909, 0.5241696, 0.5248811, 0.43823197, 0.46017706, 0.5001389, 0.5067691, 0.43532795, 0.54133034, 0.5668129, 0.44663444, 0.57333153, 0.51220936, 0.44793743, 0.5642572, 0.5735944, 0.5257793, 0.5809837, 0.46143544, 0.44543713, 0.42601314, 0.4235008, 0.1435746, 0.2840013, 0.4652959, 0.4705862, 0.2551297, 0.4014538, 0.4792972, 0.4986418, 0.10876608, 0.327152, 0.43615222, 0.19259521, 0.15260118, 0.18438193, 0.4008071, 0.29156065, 0.40444165, 0.33468056, 0.16256261, 0.17389816, 0.3493546, 0.248882, 0.46924335, 0.25910282, 0.22707942, 0.19523305, 0.24310312, 0.54467887, 0.47388896, 0.5911726, 0.077623606, 0.13672984, 0.28011692, 0.15300265, 0.21979022, 0.55541474, 0.45936662, 0.4518411, 0.5240046, 0.2286638, 0.500331, 0.19998828, 0.4166937, 0.13793826, 0.25115037, 0.240834, 0.20866278, 0.29204017, 0.10993287, 0.2836103, 0.09310117, 0.13999507, 0.1393562, 0.18662873, 0.104163796, 0.2641899, 0.23372144, 0.18650204, 0.39082986, 0.1713137, 0.3631019, 0.45249185, 0.16378736, 0.31993818, 0.20295581, 0.15818167, 0.19197646, 0.37173802, 0.19917351, 0.32338768, 0.13956437, 0.45269197, 0.12373054, 0.30917227, 0.38313022, 0.2436651, 0.2777815, 0.48153907, 0.26612732, 0.23971504, 0.4368118, 0.12972963, 0.11136517, 0.5377966, 0.21517494, 0.18814015, 0.21390763, 0.20073861, 0.21620917, 0.43240362, 0.5137389, 0.5711338, 0.23292807, 0.20356363, 0.12935242, 0.40257573, 0.19817907, 0.1862928, 0.17434242, 0.11425087, 0.21966514, 0.44109714, 0.27282405, 0.18096074, 0.51820797, 0.25029135, 0.25283456, 0.20651925, 0.1872493, 0.17495677, 0.43305242, 0.22375461, 0.2579043, 0.25754625, 0.17979577, 0.39178124, 0.29458416, 0.28428748, 0.23418885, 0.5453904, 0.5089704, 0.15893137, 0.1290605, 0.39882773, 0.19303322, 0.24817374, 0.4437155, 0.3312676, 0.27956617, 0.14090163, 0.110815346, 0.25131798, 0.13767755, 0.25797382, 0.54207623, 0.33685213, 0.53181225, 0.51118, 0.15160975, 0.2599699, 0.16030625, 0.29307336, 0.28207695, 0.24795955, 0.37653187, 0.26835018, 0.34308493, 0.1399968, 0.43604165, 0.4587317, 0.56371355, 0.5127736, 0.37688047, 0.16234088, 0.3401063, 0.564144, 0.26836357, 0.58343494, 0.39720204, 0.5754172, 0.14564377, 0.17994887, 0.379329, 0.17187947, 0.18267816, 0.4536685, 0.22792053, 0.26139513, 0.4366112, 0.20337978, 0.14404842, 0.25573415, 0.1933009, 0.50085133, 0.30771053, 0.51157224, 0.25061226, 0.24677625, 0.4612123, 0.118775666, 0.12287128, 0.5286819, 0.20602375, 0.5312234, 0.60285217, 0.43378896, 0.1948846, 0.17117575, 0.5586176, 0.3352617, 0.44230402, 0.45914894, 0.29982263, 0.442304, 0.15527198, 0.33310518, 0.23724118, 0.5118173, 0.26857948, 0.15802848, 0.19746965, 0.069399655, 0.3462085, 0.16781947, 0.5001859, 0.2977857, 0.25153285, 0.2576597, 0.2277357, 0.3653959, 0.24982399, 0.1932768, 0.2061832, 0.37068728, 0.13769814, 0.20581618, 0.2544607, 0.262086, 0.16524693, 0.17075348, 0.27200687, 0.20874834, 0.51089466, 0.19545248, 0.40347475, 0.2851605, 0.22767967, 0.2804839, 0.18780228, 0.45266637, 0.21898094, 0.5339318, 0.49483013, 0.68922305, 0.5480236, 0.42272648, 0.54372424, 0.47430432, 0.5511756, 0.8270877, 0.77820396, 0.4622003, 0.6986774, 0.78131694, 0.6013939, 0.5616209, 0.49591368, 0.7023209, 0.64340776, 0.42155623, 0.527152, 0.5365094, 0.57585573, 0.7073357, 0.5621189, 0.5212526, 0.48264283, 0.4544716, 0.46796918, 0.46028295, 0.4636257, 0.43719342, 0.5047995, 0.43572462, 0.6772498, 0.6261944, 0.43241677, 0.49451274, 0.5752612, 0.5329443, 0.56159365, 0.39046264, 0.30958128, 0.22778246, 0.16877171, 0.42407042, 0.56504864, 0.52432936, 0.14638266, 0.25498956, 0.42947975, 0.16581881, 0.24930876, 0.20747635, 0.18561938, 0.19150919, 0.13872439, 0.38840258, 0.27115017, 0.11794534, 0.17848772, 0.253649, 0.16931811, 0.4037082, 0.19817954, 0.3126956, 0.2255466, 0.66230404, 0.58198625, 0.36475712, 0.21651497, 0.22941887, 0.23697448, 0.5430567, 0.0943467, 0.18123111, 0.44350094, 0.1600028, 0.48787573, 0.25639814, 0.24738926, 0.08246863, 0.45682362, 0.24167031, 0.29682118, 0.4732614, 0.49169487, 0.48179334, 0.17674473, 0.23586237, 0.38145524, 0.24535501, 0.5373241, 0.1866563, 0.35619253, 0.4498595, 0.46534953, 0.52964777, 0.24068823, 0.09270531, 0.2576687, 0.26208368, 0.24572355, 0.22860315, 0.31036007, 0.16971833, 0.1576033, 0.25882143, 0.120854884, 0.19085282, 0.24403045, 0.4348358, 0.57095844, 0.50787264, 0.47978306, 0.55797493, 0.44785827, 0.48957467, 0.5059309, 0.45567742, 0.4509389, 0.43619192, 0.47722703, 0.57298684, 0.44057295, 0.48895177, 0.5329453, 0.41362056, 0.4381585, 0.55936956, 0.46145606, 0.5930782, 0.55922216, 0.5739875, 0.47736323, 0.46834275, 0.45393705, 0.5399202, 0.562724, 0.49366835, 0.45236045, 0.5131588, 0.45168257, 0.5346608, 0.5251918, 0.5307311, 0.5552938, 0.52742666, 0.5190037, 0.44211596, 0.49832767, 0.5509728, 0.46216765, 0.5307264, 0.4146065, 0.43563384, 0.45474052, 0.5611598, 0.5187298, 0.5537865, 0.57458496, 0.520233, 0.5393932, 0.4967857, 0.52167267, 0.4557389, 0.5182542, 0.46926898, 0.53754306, 0.5338161, 0.424431, 0.53808546, 0.48993325, 0.43079478, 0.5416667, 0.4592346, 0.48145553, 0.45711204, 0.516143, 0.5192493, 0.5739251, 0.5658158, 0.4484658, 0.5229493, 0.4585013, 0.53588456, 0.5015563, 0.5275938, 0.4693819, 0.4917732, 0.53507954, 0.48203355, 0.5627005, 0.4595976, 0.4362644, 0.50481856, 0.46445698, 0.53589743, 0.41727826, 0.46333006, 0.54031825, 0.51403314, 0.5787495, 0.5792448, 0.46964952, 0.5234789, 0.4619436, 0.53048444, 0.5254047, 0.49234492, 0.5673212, 0.48738626, 0.56375265, 0.48732442, 0.5643754, 0.5239815, 0.51513165, 0.42494038, 0.49800923, 0.5514843, 0.5401826, 0.6117812, 0.51811117, 0.4941422, 0.53265166, 0.57406515, 0.5225945, 0.5885506, 0.5240274, 0.45824423, 0.54217947, 0.5340014, 0.4563499, 0.47893322, 0.4683326, 0.4855184, 0.5595172, 0.4802879, 0.24482301, 0.4490614, 0.18644193, 0.14545643, 0.2631388, 0.18713954, 0.59627926, 0.14603752, 0.17459655, 0.23335564, 0.18733764, 0.14055061, 0.24914026, 0.20851722, 0.32733685, 0.34540638, 0.28299442, 0.16823384, 0.48854312, 0.26491743, 0.5483824, 0.10269356, 0.1916773, 0.19778895, 0.07769135, 0.22351101, 0.16099685, 0.3873844, 0.15432212, 0.22332636, 0.22281206, 0.32323402, 0.5058547, 0.4993924, 0.26570508, 0.43127298, 0.3857516, 0.47580034, 0.56659657, 0.21110499, 0.18613043, 0.13335651, 0.4334482, 0.17467281, 0.13983163, 0.5628333, 0.22158533, 0.08566022, 0.2560651, 0.5905067, 0.20608443, 0.15946493, 0.54772335, 0.082140595, 0.20810837, 0.14201331, 0.14132425, 0.19457832, 0.46616164, 0.23089668, 0.27934408, 0.1717833, 0.3768796, 0.23368302, 0.096070826, 0.16324207, 0.13532943, 0.07427925, 0.19444379, 0.20866266, 0.25244242, 0.12797326, 0.09459236, 0.21771398, 0.2088179, 0.27590513, 0.20352104, 0.3394515, 0.19789082, 0.17134556, 0.12813875, 0.5008899, 0.5072031, 0.2914037, 0.14030623, 0.1094794, 0.16392821, 0.14502832, 0.21172795, 0.57914585, 0.58673865, 0.5255234, 0.46006417, 0.5044212, 0.61498076, 0.43393135, 0.48170102, 0.4757244, 0.55029744, 0.5444358, 0.49997994, 0.52649164, 0.51557523, 0.43830281, 0.5156522, 0.60362136, 0.5368697, 0.48901263, 0.43081602, 0.5891012, 0.5540908, 0.49097294, 0.48187694, 0.47181082, 0.55663407, 0.53794813, 0.4553486, 0.35708168, 0.4806093, 0.2005941, 0.5043314, 0.5062828, 0.32363474, 0.20167288, 0.27967274, 0.37619993, 0.33547693, 0.51644886, 0.27280176, 0.23172677, 0.30134988, 0.3593486, 0.28088212, 0.4818843, 0.22382674, 0.31639048, 0.39598063, 0.5157821, 0.538954, 0.4591385, 0.5002062, 0.40784085, 0.47598326, 0.45731556, 0.45105654, 0.47785708, 0.56334156, 0.4533861, 0.4632182, 0.36707237, 0.41084695, 0.5292508, 0.14627066, 0.289473, 0.33092138, 0.19525501, 0.12701154, 0.2663437, 0.593389, 0.24447155, 0.11179042, 0.504526, 0.34377784, 0.261895, 0.18403876, 0.49054912, 0.21112853, 0.45794365, 0.15162009, 0.1952101, 0.5495343, 0.5335662, 0.092981964, 0.11654687, 0.24288142, 0.2531255, 0.10690522, 0.09644863, 0.22939295, 0.15469596, 0.41438982, 0.26178008, 0.18194473, 0.4520896, 0.4438553, 0.14744896, 0.4828082, 0.49409628, 0.23735598, 0.434626, 0.21227598, 0.09424698, 0.18420443, 0.5334336, 0.44349402, 0.5442852, 0.3093165, 0.24317512, 0.3268745, 0.49656826, 0.5884876, 0.4767331, 0.5681507, 0.63510764, 0.5185212, 0.5402115, 0.6096985, 0.60656285, 0.5981594, 0.49301246, 0.468958, 0.8134308, 0.6812688, 0.7095274, 0.517383, 0.49870425, 0.4957741, 0.48817956, 0.5204811, 0.5060304, 0.44570008, 0.45632842, 0.529631, 0.454188, 0.5743076, 0.54381907, 0.45716488, 0.51676965, 0.5640896, 0.5063769, 0.552251, 0.41302708, 0.531184, 0.56023884, 0.4959838, 0.48456752, 0.47817993, 0.5181262, 0.5436909, 0.49795017, 0.5023631, 0.50948167, 0.53212166, 0.45229682, 0.48373613, 0.46082562, 0.49481338, 0.45524678, 0.5819309, 0.46577498, 0.50430787, 0.44939697, 0.57774943, 0.4872404, 0.426866, 0.42944485, 0.44993824, 0.48557577, 0.53804994, 0.4517265, 0.48383155, 0.48839602, 0.487725, 0.5371265, 0.47616404, 0.5159852, 0.5234282, 0.55962944, 0.5311781, 0.51600224, 0.47422263, 0.4780301, 0.45260683, 0.4862504, 0.4244045, 0.60028845, 0.449642, 0.49646974, 0.52797365, 0.44099393, 0.43105054, 0.5072977, 0.4922944, 0.48614067, 0.4190307, 0.48827094, 0.45874655, 0.4405653, 0.4073574, 0.4729534, 0.4707289, 0.45173264, 0.3891293, 0.3934071, 0.5150348, 0.50306946, 0.4807096, 0.5153416, 0.4783498, 0.5508054, 0.5037144, 0.5658513, 0.39370903, 0.48095742, 0.52400815, 0.58302784, 0.52667016, 0.5475636, 0.47641605, 0.5477338, 0.48373488, 0.46241084, 0.4463783, 0.51945287, 0.4611212, 0.50396705, 0.51941955, 0.5557464, 0.46097925, 0.4822844, 0.41838932, 0.46019065, 0.45654526, 0.5299528, 0.5177837, 0.5141589, 0.5368368, 0.53933716, 0.5021498, 0.44255003, 0.40248084, 0.4833918, 0.54400015, 0.5279106, 0.49300495, 0.41985282, 0.4987849, 0.47603565, 0.46463728, 0.4181327, 0.40419775, 0.42047495, 0.45479965, 0.51382756, 0.49421912, 0.46895143, 0.51741636, 0.47301435, 0.4560309, 0.5422663, 0.41369176, 0.50026006, 0.42998537, 0.56855357, 0.5411832, 0.51704276, 0.4781739, 0.5692204, 0.48863798, 0.5351881, 0.47226855, 0.46122733, 0.51419353, 0.5833909, 0.52403873, 0.532855, 0.5132236, 0.4072068, 0.5396157, 0.44767118, 0.4323842, 0.48344007, 0.4856052, 0.47169715, 0.4856145, 0.45666626, 0.44468847, 0.52040935, 0.41436964, 0.4544824, 0.51641494, 0.5987923, 0.522238, 0.48809266, 0.54628915, 0.5132546, 0.55975896, 0.41554368, 0.5057127, 0.5098922, 0.5185489, 0.48606235, 0.4418942, 0.4075626, 0.534381, 0.4853324, 0.5296225, 0.53718024, 0.45410773, 0.45644403, 0.58892936, 0.5010595, 0.54662496, 0.45902878, 0.47428638, 0.5706817, 0.52987033, 0.5019051, 0.5138022, 0.48954555, 0.4963465, 0.5227582, 0.5851403, 0.5099987, 0.5181441, 0.4634535, 0.48181093, 0.58184046, 0.45587945, 0.46082932, 0.45436037, 0.43366432, 0.5331754, 0.50056016, 0.548273, 0.49967203, 0.5603154, 0.46893275, 0.48488837, 0.47405377, 0.41925696, 0.57101846, 0.4992545, 0.5393102, 0.4621238, 0.41189337, 0.51742107, 0.43287525, 0.53529936, 0.5775379, 0.49451172, 0.54596144, 0.5738393, 0.6243569, 0.55997294, 0.5147205, 0.46729475, 0.5216621, 0.5119819, 0.49491262, 0.4339214, 0.4981057, 0.51835525, 0.42316696, 0.44508964, 0.50718963, 0.45879495, 0.45269638, 0.46438798, 0.49698335, 0.544361, 0.43736115, 0.4366358, 0.43311056, 0.48953477, 0.4331119, 0.47516596, 0.5303694, 0.4177412, 0.45210215, 0.5385833, 0.588443, 0.43118075, 0.5330405, 0.4943129, 0.5298308, 0.5032702, 0.607629, 0.47634548, 0.46974486, 0.5576127, 0.5726335, 0.48584682, 0.56443024, 0.507144, 0.49337232, 0.4984276, 0.5956273, 0.54712206, 0.48391902, 0.4366773, 0.4795359, 0.5886966, 0.45457405, 0.536878, 0.5585477, 0.5061072, 0.52074695, 0.5021153, 0.5345463, 0.53052026, 0.46493173, 0.5264438, 0.46118802, 0.4797672, 0.49298123, 0.52444184, 0.5493127, 0.52764994, 0.4677564, 0.47093725, 0.4606302, 0.4390819, 0.5898276, 0.5241845, 0.49081522, 0.49198142, 0.4856604, 0.5671334, 0.6080605, 0.48119417, 0.5125007, 0.43701544, 0.5071921, 0.4719628, 0.49998668, 0.4440054, 0.53047186, 0.39619985, 0.5110094, 0.5225846, 0.49974883, 0.41026407, 0.5381645, 0.49669737, 0.43123424, 0.51839423, 0.4346726, 0.4877639, 0.53088516, 0.50898683, 0.48440132, 0.482827, 0.4899449, 0.40873808, 0.45810097, 0.5401854, 0.17089513, 0.43266013, 0.5473411, 0.4806444, 0.19433519, 0.18765467, 0.25511715, 0.09138256, 0.41960904, 0.31911367, 0.34914547, 0.32679957, 0.24194375, 0.24007896, 0.4557074, 0.32605428, 0.17243621, 0.28925413, 0.19775957, 0.26462734, 0.37468043, 0.42180708, 0.389801, 0.51097023, 0.41450906, 0.4589766, 0.4099174, 0.42238984};
        double[] finalProbabilityList = probabilityList;

        List<Probability> finalList = new ArrayList<>();
        // 뎁스0 인 애들 찾기 : st_id를 바탕으로 answer_id, concept_id, skill_id
        List<Probability> depth0 = answerRepository.findIds(studentTestId);
            // 뎁스 0은 확률 조건에 관계 없이 우선 다 저장
        for (Probability probability : depth0){
            probability.setToConceptDepth(0);
            probability.setProbabilityPercent(probabilityList[probability.getSkillId()-1]);
        }
        finalList.addAll(depth0);
        // 뎁스 1인 애들 찾기
            // 뎁스 0 중 pList[s_id-1]<0.5 인 경우만 남김
        depth0.removeIf(probability -> finalProbabilityList[probability.getSkillId() - 1] > 0.5);
            // 각 c_id들을 돌면서 depth가 1인 probability 생성
        for (Probability pro1 : depth0){
            List<Probability> depth1 = probabilityRepository.findToConcept(pro1.getAnswerId(), pro1.getConceptId());
            for (Probability pro2 : depth1){
                pro2.setToConceptDepth(1);
                pro2.setProbabilityPercent(probabilityList[pro2.getSkillId()-1]);
            }
            finalList.addAll(depth1);
            // 뎁스 2인 애들 찾기
            depth1.removeIf(probability -> finalProbabilityList[probability.getSkillId() - 1] > 0.5);
            for (Probability pro3 : depth1){
                List<Probability> depth2 = probabilityRepository.findToConcept(pro3.getAnswerId(), pro3.getConceptId());
                for (Probability pro4 : depth2){
                    pro4.setToConceptDepth(2);
                    pro4.setProbabilityPercent(probabilityList[pro4.getSkillId()-1]);
                }
                finalList.addAll(depth2);
            }
        }
        // 마지막으로 insert
        probabilityRepository.save(finalList);
    }

    // 리팩토링 : 지금은 선수(후수)단위개념이 어떤 단위개념에서 파생됐는지 연결 x
    public DetailsResponse findDetails(Long studentTestId){
        DetailsResponse detailsResponse = new DetailsResponse();
        // studentName, studentBirthdate, testName
        StudentTests studentTests = studentTestService.findDetails(studentTestId);
        detailsResponse.setStudentName(studentTests.getStudentName());
        detailsResponse.setStudentBirthdate(studentTests.getStudentBirthdate());
        detailsResponse.setTestName(studentTests.getTestName());
        //
        detailsResponse.setItemProbabilityResponseList(ProbabilityConverter.convertListToItemProbabilityResponseList(probabilityRepository.findItemProbability(studentTestId)));

        // 확률 50% 이하인 단위개념
        detailsResponse.setConceptNameList(probabilityRepository.findConceptNameUnder50(studentTestId));
        // 추가 학습이 필요한 선수단위개념
        detailsResponse.setToConceptNameList(probabilityRepository.findToConceptName(studentTestId));
        // 후속 학습의 후수단위개념
        detailsResponse.setFromConceptNameList(probabilityRepository.findFromConceptName(studentTestId));
        return detailsResponse;
    }

}
